import{s as V,a as L}from"./index-D491UzHh.js";import{s as R,a as T,b as B,c as z,d as A,e as N,g as U}from"./index-B6UJGvDB.js";import{s as M}from"./index-Cob0FvQU.js";import{s as q}from"./index-DLoo_FT-.js";import{_ as J,a as p,c as _,b as l,d as i,w as d,r as K,o as f,e as O,g as h,t as c,h as v,n as y,p as P,i as E,s as Y}from"./index-1PYYOqbW.js";const G={data(){return{hutangs:null,hutang:{},data:{},columns:null,customerLevel:[],customerSelected:null,masterHutangLevel:[],masterHutangSelected:null,totalRecords:0,loading:!1,isLoading:!1,params:{},filters:"",deleteDialog:!1,hutangDialog:!1,submitted:!1}},created(){this.columns=[{field:"nama_hutang",header:"Nama Hutang",style:"min-width:150px;"},{field:"jumlah_maksimal",header:"Jumlah maksimal",style:"min-width:150px;"},{field:"jatuh_tempo",header:"Jatuh Tempo",style:"min-width:150px;"}],this.getAllCustomer(),this.getAllMasterHutang()},mounted(){this.loadData()},methods:{async getAllCustomer(){const a=localStorage.getItem("token"),t=await p.get("v1/customer_all",{headers:{Authorization:`Bearer ${a}`}}).catch(r=>{this.loading=!1;const o=r.response.data;o.meta.code==401?(localStorage.removeItem("token"),this.$router.push({name:"login"})):this.$toast.add({severity:"error",summary:"Failed!",detail:o.data.errors,life:3e3})});t.data.meta.code==200&&t.data.data.forEach(o=>{this.customerLevel.push({code:o.ID,name:o.name})})},async getAllMasterHutang(){const a=localStorage.getItem("token"),t=await p.get("v1/master_hutang_all",{headers:{Authorization:`Bearer ${a}`}}).catch(r=>{this.loading=!1;const o=r.response.data;o.meta.code==401?(localStorage.removeItem("token"),this.$router.push({name:"login"})):this.$toast.add({severity:"error",summary:"Failed!",detail:o.data.errors,life:3e3})});t.data.meta.code==200&&t.data.data.forEach(o=>{this.masterHutangLevel.push({code:o.ID,name:o.nama_hutang})})},formatRupiah(){let a=this.hutang.jumlah_hutang.toString().replace(/\D/g,""),t=new Intl.NumberFormat("id-ID",{maximumFractionDigits:0}).format(a);this.hutang.jumlah_hutang=t},formatRupiahData(a){let t;return t=a.toString().replace(/\D/g,""),new Intl.NumberFormat("id-ID",{maximumFractionDigits:0}).format(t)},async loadData(){const a=localStorage.getItem("token");this.loading=!0,this.params.filters=this.filters;const t=Object.keys(this.params).map(o=>encodeURIComponent(o)+"="+encodeURIComponent(this.params[o])).join("&"),r=await p.get("v1/hutang?"+t,{headers:{Authorization:`Bearer ${a}`}}).catch(o=>{this.loading=!1;const e=o.response.data;e.meta.code==401?(localStorage.removeItem("token"),this.$router.push({name:"login"})):this.$toast.add({severity:"error",summary:"Failed!",detail:e.data.errors,life:3e3})});if(r.data.meta.code==200){const o=r.data;this.hutangs=o.data.data,this.totalRecords=o.data.countData,this.loading=!1}},onPage(a){this.params=a.originalEvent,this.params.sortField=a.sortField,this.params.sortOrder=a.sortOrder,this.loadData()},onSort(a){this.params.sortField=a.sortField,this.params.sortOrder=a.sortOrder,this.loadData()},onFilter(){this.loadData()},refresh(){this.loadData()},newData(){this.hutang={},this.hutang.jumlah_hutang="",this.masterHutangSelected=null,this.customerSelected=null,this.submitted=!1,this.hutangDialog=!0,this.isLoading=!1},hideDialog(){this.masterHutangDialog=!1,this.submitted=!1,this.isLoading=!1},editData(a){this.hutang={...a},this.customerSelected=a.customer.ID,this.masterHutangSelected=a.master_hutang.ID,this.hutang.tanggal_transaksi=new Date(this.hutang.tgl_transaksi),this.formatRupiah(),this.hutangDialog=!0,this.submitted=!1},async saveData(){const a=localStorage.getItem("token");if(this.isLoading=!0,this.hutang.ID)if(this.submitted=!0,this.hutang.tanggal_transaksi&&this.hutang.jumlah_hutang&&this.customerSelected&&this.masterHutangSelected){const t=this.formatDate(this.hutang.tanggal_transaksi);let r={id:this.hutang.ID,customer_id:this.customerSelected,master_hutang_id:this.masterHutangSelected,tgl_transaksi:t,jumlah_hutang:parseInt(this.hutang.jumlah_hutang.replace(/\./g,""))};const o=await p.put("v1/hutang",r,{headers:{Authorization:`Bearer ${a}`}}).catch(e=>{this.isLoading=!1;const n=e.response.data;n.meta.code==401?(localStorage.removeItem("token"),this.$router.push({name:"login"})):(this.isLoading=!1,this.$toast.add({severity:"error",summary:"Failed!",detail:n.data.errors,life:3e3}))});if(o.data.meta.code==200){await this.loadData();const e=o.data;this.isLoading=!1,this.hutangDialog=!1,this.$toast.add({severity:"success",summary:e.meta.message,detail:"Hutang has been updated!",life:3e3})}}else this.isLoading=!1,this.$toast.add({severity:"error",summary:"Failed!",detail:"Input must be required!",life:3e3});else if(this.submitted=!0,this.hutang.tanggal_transaksi&&this.hutang.jumlah_hutang&&this.customerSelected&&this.masterHutangSelected){const t=this.formatDate(this.hutang.tanggal_transaksi),r={customer_id:this.customerSelected,master_hutang_id:this.masterHutangSelected,tgl_transaksi:t,jumlah_hutang:parseInt(this.hutang.jumlah_hutang.replace(/\./g,""))},o=await p.post("v1/hutang",r,{headers:{Authorization:`Bearer ${a}`}}).catch(e=>{this.isLoading=!1;const n=e.response.data;n.meta.code==401?(localStorage.removeItem("token"),this.$router.push({name:"login"})):this.$toast.add({severity:"error",summary:"Failed!",detail:n.data.errors,life:5e3})});if(o.data.meta.code==201){await this.loadData();const e=o.data;this.hutangDialog=!1,this.isLoading=!1,this.$toast.add({severity:"success",summary:e.meta.message,detail:"hutang customer has been added!",life:3e3})}}else this.isLoading=!1,this.$toast.add({severity:"error",summary:"Failed!",detail:"Input must be required!",life:3e3})},confirmDelete(a){this.hutang=a,this.deleteDialog=!0},async deleteData(){if(this.hutang.ID){const a=localStorage.getItem("token"),t=await p.delete("v1/hutang/"+this.hutang.ID,{headers:{Authorization:`Bearer ${a}`}}).catch(r=>{this.loading=!1;const o=r.response.data;o.meta.code==401?(localStorage.removeItem("token"),this.$router.push({name:"login"})):this.$toast.add({severity:"error",summary:"Failed!",detail:o.data.errors,life:3e3})});if(t.data.meta.code==200){const r=t.data;this.loading=!1,this.deleteDialog=!1,this.loadData(),this.$toast.add({severity:"success",summary:r.meta.message,detail:"hutang has been deleted!",life:3e3})}}else this.$toast.add({severity:"error",summary:"Failed!",detail:"Please reload data",life:3e3})},formatDate(a){if(a==null)return"";{let t=a.getDate(),r=a.getMonth()+1,o=a.getFullYear();return t<10&&(t="0"+t),r<10&&(r="0"+r),t+"/"+r+"/"+o}},formatDateData(a){const t=new Date(a),r=String(t.getDate()).padStart(2,"0"),o=String(t.getMonth()+1).padStart(2,"0"),e=t.getFullYear();return`${r}/${o}/${e}`},getSeverity(a){switch(a){case"overdue":return"danger";case"paid":return"success";case"unpaid":return"warn"}}}},m=a=>(P("data-v-2c01b6c5"),a=a(),E(),a),Q={class:"flex flex-col"},W={class:"col-12"},X={class:"col-12"},Z={class:"card"},$=m(()=>i("h5",null,"Hutang Customer",-1)),tt={class:"my-2"},et={class:"flex flex-wrap gap-2 items-center justify-between"},at=m(()=>i("i",{class:"pi pi-search"},null,-1)),st={class:"flex align-items-center justify-content-center"},ot=m(()=>i("i",{class:"pi pi-exclamation-triangle mr-3",style:{"font-size":"2rem"}},null,-1)),lt={key:0},it=m(()=>i("svg",{class:"pl",width:"240",height:"240",viewBox:"0 0 240 240"},[i("circle",{class:"pl__ring pl__ring--a",cx:"120",cy:"120",r:"105",fill:"none",stroke:"#000","stroke-width":"20","stroke-dasharray":"0 660","stroke-dashoffset":"-330","stroke-linecap":"round"}),i("circle",{class:"pl__ring pl__ring--b",cx:"120",cy:"120",r:"35",fill:"none",stroke:"#000","stroke-width":"20","stroke-dasharray":"0 220","stroke-dashoffset":"-110","stroke-linecap":"round"}),i("circle",{class:"pl__ring pl__ring--c",cx:"85",cy:"120",r:"70",fill:"none",stroke:"#000","stroke-width":"20","stroke-dasharray":"0 440","stroke-linecap":"round"}),i("circle",{class:"pl__ring pl__ring--d",cx:"155",cy:"120",r:"70",fill:"none",stroke:"#000","stroke-width":"20","stroke-dasharray":"0 440","stroke-linecap":"round"})],-1)),rt=[it],nt={class:"grid grid-cols-12 gap-4 mb-5"},dt={class:"col-span-6"},ut=m(()=>i("div",{class:"font-regular"},"Nama Customer",-1)),ht={key:0,class:"p-invalid-text"},ct={class:"col-span-6"},mt=m(()=>i("div",{class:"font-regular"},"Master hutang",-1)),gt={key:0,class:"p-invalid-text"},pt={class:"grid grid-cols-12 gap-4"},_t={class:"col-span-6"},ft=m(()=>i("div",{class:"font-regular"},"Tanggal transaksi",-1)),yt={key:0,class:"p-invalid"},vt={class:"col-span-6"},kt=m(()=>i("label",{for:"jumlah_hutang"},"Jumlah hutang",-1)),bt={key:0,class:"p-invalid-text"};function Dt(a,t,r,o,e,n){const S=Y,w=K("router-view"),g=q,x=B,k=M,I=z,C=A,u=N,F=V,j=R,b=T,D=U,H=L;return f(),_("div",Q,[l(S),i("div",W,[l(w,{onRefreshTable:n.refresh},null,8,["onRefreshTable"])]),i("div",X,[i("div",Z,[$,l(j,{lazy:!0,paginator:!0,rows:10,scrollable:!0,scrollHeight:"flex",value:e.hutangs,totalRecords:e.totalRecords,loading:e.loading,onPage:t[2]||(t[2]=s=>n.onPage(s)),onSort:t[3]||(t[3]=s=>n.onSort(s)),onFilter:t[4]||(t[4]=s=>n.onFilter(s)),ref:"dt",dataKey:"id",responsiveLayout:"scroll"},{default:d(()=>[l(C,{class:"mb-4"},{start:d(()=>[i("div",tt,[l(g,{label:"New",icon:"pi pi-plus",class:"p-button-success mr-2",onClick:n.newData},null,8,["onClick"])])]),end:d(()=>[i("div",et,[l(I,null,{default:d(()=>[l(x,null,{default:d(()=>[at]),_:1}),l(k,{modelValue:e.filters,"onUpdate:modelValue":t[0]||(t[0]=s=>e.filters=s),placeholder:"Search...",onKeydown:t[1]||(t[1]=O(s=>n.onFilter(),["enter"]))},null,8,["modelValue"])]),_:1})])]),_:1}),l(u,{header:"Nama customer",sortable:!0,style:{"min-width":"150px"}},{body:d(s=>[h(c(s.data.customer.name),1)]),_:1}),l(u,{header:"Master hutang",sortable:!0,style:{"min-width":"150px"}},{body:d(s=>[h(c(s.data.master_hutang.nama_hutang),1)]),_:1}),l(u,{header:"Tanggal transaksi",sortable:!0,style:{"min-width":"160px"}},{body:d(s=>[h(c(n.formatDateData(s.data.tgl_transaksi)),1)]),_:1}),l(u,{header:"Tanggal jatuh tempo",sortable:!0,style:{"min-width":"180px"}},{body:d(s=>[h(c(n.formatDateData(s.data.tgl_jatuh_tempo)),1)]),_:1}),l(u,{header:"Jumlah hutang",sortable:!0,style:{"min-width":"150px"}},{body:d(s=>[h(c(n.formatRupiahData(s.data.jumlah_hutang)),1)]),_:1}),l(u,{header:"Total dibayar",sortable:!0,style:{"min-width":"150px"}},{body:d(s=>[h(c(n.formatRupiahData(s.data.total_dibayar)),1)]),_:1}),l(u,{header:"Sisa tagihan",sortable:!0,style:{"min-width":"150px"}},{body:d(s=>[h(c(n.formatRupiahData(s.data.sisa_tagihan)),1)]),_:1}),l(u,{header:"Status",style:{"min-width":"150px"}},{body:d(s=>[l(F,{value:s.data.status,severity:n.getSeverity(s.data.status)},null,8,["value","severity"])]),_:1}),l(u,{headerStyle:"min-width:10rem;",frozen:"",alignFrozen:"right"},{body:d(s=>[l(g,{icon:"pi pi-trash",class:"p-button-rounded p-button-warning mt-2",onClick:St=>n.confirmDelete(s.data)},null,8,["onClick"])]),_:1})]),_:1},8,["value","totalRecords","loading"]),l(b,{visible:e.deleteDialog,"onUpdate:visible":t[6]||(t[6]=s=>e.deleteDialog=s),style:{width:"450px"},header:"Confirm",modal:!0},{footer:d(()=>[l(g,{label:"No",icon:"pi pi-times",class:"p-button-secondary",onClick:t[5]||(t[5]=s=>e.deleteDialog=!1)}),l(g,{label:"Yes",icon:"pi pi-check",class:"p-button-danger",onClick:n.deleteData},null,8,["onClick"])]),default:d(()=>[i("div",st,[ot,e.hutang?(f(),_("span",lt,[h("Are you sure you want to delete "),i("b",null,c(e.hutang.customer.name),1),h("?")])):v("",!0)])]),_:1},8,["visible"]),l(b,{visible:e.hutangDialog,"onUpdate:visible":t[11]||(t[11]=s=>e.hutangDialog=s),style:{width:"550px",position:"relatif"},header:"Form Hutang Customer",modal:!0,class:"p-fluid"},{footer:d(()=>[l(g,{label:"Cancel",icon:"pi pi-times",text:"",onClick:n.hideDialog},null,8,["onClick"]),l(g,{label:"Save",icon:"pi pi-check",onClick:n.saveData},null,8,["onClick"])]),default:d(()=>[i("div",{class:y(e.isLoading?"canvas-loading loading-icon":"canvas-loading loading-icon-hide")},rt,2),i("div",{class:y(e.isLoading?"canvas-form-opacity":"canvas-form")},[i("div",nt,[i("div",dt,[ut,l(D,{modelValue:e.customerSelected,"onUpdate:modelValue":t[7]||(t[7]=s=>e.customerSelected=s),options:e.customerLevel,optionLabel:"name",optionValue:"code",placeholder:"Select customer",autofocus:"",class:y({"p-invalid":e.submitted&&!e.customerSelected}),filter:!0,style:{width:"100%"}},null,8,["modelValue","options","class"]),e.submitted&&!e.customerSelected?(f(),_("small",ht,"Customer is required.")):v("",!0)]),i("div",ct,[mt,l(D,{modelValue:e.masterHutangSelected,"onUpdate:modelValue":t[8]||(t[8]=s=>e.masterHutangSelected=s),options:e.masterHutangLevel,optionLabel:"name",optionValue:"code",placeholder:"Select master hutang",autofocus:"",class:y({"p-invalid":e.submitted&&!e.masterHutangSelected}),filter:!0,style:{width:"100%"}},null,8,["modelValue","options","class"]),e.submitted&&!e.masterHutangSelected?(f(),_("small",gt,"Master hutang is required.")):v("",!0)])]),i("div",pt,[i("div",_t,[ft,l(H,{showIcon:!0,class:y(e.submitted&&!e.hutang.tanggal_transaksi?"p-invalid":""),showButtonBar:!0,modelValue:e.hutang.tanggal_transaksi,"onUpdate:modelValue":t[9]||(t[9]=s=>e.hutang.tanggal_transaksi=s),style:{width:"100%"}},null,8,["class","modelValue"]),e.submitted&&!e.hutang.tanggal_transaksi?(f(),_("small",yt,"Tanggal transaksi is required.")):v("",!0)]),i("div",vt,[kt,l(k,{id:"jumlah_hutang",placeholder:"Jumlah hutang",modelValue:e.hutang.jumlah_hutang,"onUpdate:modelValue":t[10]||(t[10]=s=>e.hutang.jumlah_hutang=s),modelModifiers:{trim:!0},autofocus:"",class:y({"p-invalid":e.submitted&&!e.hutang.jumlah_hutang}),fluid:"",onKeyup:n.formatRupiah},null,8,["modelValue","class","onKeyup"]),e.submitted&&!e.hutang.jumlah_hutang?(f(),_("small",bt,"Jumlah hutang is required.")):v("",!0)])])],2)]),_:1},8,["visible"])])])])}const jt=J(G,[["render",Dt],["__scopeId","data-v-2c01b6c5"]]);export{jt as default};
